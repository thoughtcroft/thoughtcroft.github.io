<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="apple-touch-icon" sizes="180x180" href="/resources/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/resources/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/resources/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/resources/manifest.json">
<link rel="mask-icon" href="/resources/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">


  <title>Simplify server access by using an SSH config file</title>
  <meta name="description" content="If you are a devops engineer or a developer, at some point you will needto jump onto a server to configure some software, access logs andgenerally just check...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://wazza-is-awesome.com/devops/taking-control-of-your-ssh-config.html">
  <link rel="alternate" type="application/rss+xml" title="wazza is awesome" href="http://wazza-is-awesome.com/feed.xml">
  
    <!-- Add Google Analytics. -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-81713354-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics. -->

  
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">wazza is awesome</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
          <a class="page-link" href="/archive/">Archive</a>
          
        
          
          <a class="page-link" href="/categories/">Categories</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/tag/">Tags</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Simplify server access by using an SSH config file</h1>
    <p class="post-meta"><time datetime="2016-08-04T00:00:00+10:00" itemprop="datePublished">Aug 4, 2016</time>
    
     • <a href="/tag/devops.html" rel="tag">devops</a>, <a href="/tag/host.html" rel="tag">host</a>, <a href="/tag/keys.html" rel="tag">keys</a>, <a href="/tag/password.html" rel="tag">password</a>, <a href="/tag/security.html" rel="tag">security</a>, <a href="/tag/ssh.html" rel="tag">ssh</a></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>If you are a devops engineer or a developer, at some point you will need
to jump onto a server to configure some software, access logs and
generally just check out what is happening. If you are like me, you’ll
be doing it a lot.</p>

<p>You will likely be using ssh to login to the servers or at the very
least you will have enabled ssh key access for updating your source code
and pushing it to Github or Bitbucket. If you haven’t, then you should
to improve security and make life easier.</p>

<p>It can be difficult to remember all those <a href="http://linux.die.net/man/1/ssh">ssh
options</a>. Well, if you aren’t making the
<a href="http://linux.die.net/man/5/ssh_config">ssh config file</a> do the hard
work for you, then you are doing it wrong. Here are some helpful tips.
(I’m going to assume you have basic knowledge about ssh keys, OK?)</p>

<h3 id="what-is-the-role-of-the-ssh-config-file">What is the role of the ssh config file?</h3>

<p>In short, it is for supplying configuration to ssh. The ssh command
sources configuration parameters from the following sources in this order:</p>

<ol>
  <li>command-line options</li>
  <li>the user’s configuration file in <code class="language-plaintext highlighter-rouge">~/.ssh/config</code></li>
  <li>the system-wide configuration file in <code class="language-plaintext highlighter-rouge">/etc/ssh/ssh_config</code></li>
  <li>default values (these are listed in the system-wide config commented out)</li>
</ol>

<p>Desired behaviour can be configured to always occur or specific
behaviour for a particular host. So for example rather than always
providing an IdentityFile (-i) option for a particular host,
you can instead add this to the config file and save yourself a ton of
typing.</p>

<h3 id="what-does-one-look-like">What does one look like?</h3>

<p>Here’s an extract from one that I use to make my life easier:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># specific host settings</span>

Host github.com
  PreferredAuthentications publickey
  IdentityFile ~/.ssh/github_rsa

Host bitbucket.org
  PreferredAuthentications publickey
  IdentityFile ~/.ssh/bitbucket_rsa

<span class="c"># private CoreOS stuff</span>

Host core-01
  HostName 172.17.8.101
Host core-02
  HostName 172.17.8.102
Host core-03
  HostName 172.17.8.103
Host core-??
  User core
  IdentityFile ~/.vagrant.d/insecure_private_key
  StrictHostKeyChecking no
  UserKnownHostsFile /dev/null

<span class="c"># general settings</span>

IdentitiesOnly <span class="nb">yes
</span>ServerAliveInterval 60
</code></pre></div></div>

<p>Let’s look at how this works in practice.</p>

<h2 id="host-name-matching-is-the-key">Host name matching is the key</h2>

<p>For each configuration parameter, the first obtained value is the one
that will be used. That’s how command line options take precedence
over configuration file data. The same principle operates in the config
file.</p>

<p>Each <em>Host</em> section defines options that will take effect for any host that
matches the name referred to in the ssh command i.e.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh user@host &lt;options&gt;
</code></pre></div></div>

<p>Patterns can include <code class="language-plaintext highlighter-rouge">*</code>, <code class="language-plaintext highlighter-rouge">?</code> and can be negated using <code class="language-plaintext highlighter-rouge">!</code>.
This matching starts at the top of the file and therefore config should
be entered with host specific values at the start and general values
towards the end.</p>

<p>For example, when I enter <code class="language-plaintext highlighter-rouge">ssh core-01</code> to log onto a vm running
CoreOS, it is equivalent to me typing:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh core@172.17.8.101 <span class="nt">-i</span> ~/.vagrant.d/insecure_private_key <span class="se">\</span>
    <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="se">\</span>
    <span class="nt">-o</span> <span class="nv">UserKnownHostsFile</span><span class="o">=</span>/dev/null <span class="se">\</span>
    <span class="nt">-o</span> <span class="nv">IdentitiesOnly</span><span class="o">=</span><span class="nb">yes</span> <span class="se">\</span>
    <span class="nt">-o</span> <span class="nv">ServerAliveInterval</span><span class="o">=</span>60
</code></pre></div></div>

<h3 id="use-a-different-ssh-key-pair-per-host">Use a different ssh key-pair per host</h3>

<p>There are a lot of discussions like <a href="http://security.stackexchange.com/questions/40050/what-is-the-best-practice-separate-ssh-key-per-host-and-user-vs-one-ssh-key-for">this one on
StackEchange</a>
regarding whether you should have separate private-public key pairs for
each server or one pair to rule them all.</p>

<p>One argument against using multiple keys is that the more additional
security you add, the more convenience you give up. With the ssh config
approach, it is no less convenient to use a per-host keypair than
one-pair for all hosts, apart from the act of generating the keys and
adding them to the config.</p>

<p>I use a different pair per host. Should there be some form of compromise
or some other reason that a given key-pair must be changed, there is
minimal effort to effect that for one host without any need to alter my
security with any other host or site.</p>

<p>Configuring each key in the ssh config makes this dead simple.</p>

<h3 id="prevent-known_hosts-problems-when-using-virtual-machines">Prevent ‘known_hosts’ problems when using virtual machines</h3>

<p>If you are in the habit of spinning up and tearing down vms on a regular
basis, you will be aware of the problem whereby the ssh host key check
fails and prevents you from accessing the vm.</p>

<p>ssh maintains a list of all hosts that have been accessed in
<em>~/.ssh/known_hosts</em>. Whenever a host is accessed, it’s previous entry
is checked and if different, access will be prevented to avoid
man-in-the-middle attacks. When vms are constantly being rebuilt, this
behaviour is very frustrating and requires you to remove the offending
key manually from <em>known_hosts</em>.</p>

<p>To avoid this, I use two settings:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">UserKnownHostsFile=/dev/null</code></p>

    <p>Throw away the host key instead of adding it to the <em>known_hosts</em>
file. It isn’t possible to suppress ssh trying to save the key but
this has the same effect by disposing of it in /dev/null.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">StrictHostKeyChecking=no</code></p>

    <p>Prevent ssh from pausing to ask if the key should be saved the first
time a new host is accessed.</p>
  </li>
</ul>

<p>In combination, these settings prevent interruptions when using
ssh to access vms that change frequently. It goes without saying that
these settings are <strong>not recommended</strong> for public or long-lived servers
as they protect you from potentially harmful attempts to compromise your
security.</p>

<h3 id="other-convenience-settings">Other convenience settings</h3>

<p>I’ll leave it up to the reader to explore the other settings in detail,
but in short, here are the ones that I use to make life easier:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PreferredAuthentications=publickey</code></p>

    <p>Don’t fall back to other methods to access a server, just fail if
public key access fails. If there is a networking problem
or the public key has been deleted from <em>authorized_keys</em> on the host,
then default behaviour is to fall back to asking for a userid /
password. Since we know it is using an ssh key, don’t bother doing
this, just fail.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">IdentitiesOnly=yes</code></p>

    <p>Only use the identity files configured in the ssh config. This can
avoid conflicts when there are other identities loaded via ssh-add.
And there is no need to ssh-add any keys configured in the config
file.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ServerAliveInterval=60</code></p>

    <p>This sets the frequency in seconds for ssh to send KeepAlive messages
to the host. If no response is received to these messages, the
connection will be closed. In effect, this prevents ssh sessions with
little activity from being timed out and closed.</p>
  </li>
</ul>

<p>I hope this is as helpful for you as it has been for me. If you have any
favourite tricks or settings, leave a comment below.</p>

  </div>

</article>


<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>Jul 26, 2013</span> &raquo; <a href="/devops/how-to-write-and-install-an-ohai-plugin.html">How to write and install an Ohai plugin, the Fight Club way</a></li>
    
      <li><span>Mar 22, 2013</span> &raquo; <a href="/devops/whipping-up-awesome-with-chef.html">Whipping up awesome with Chef</a></li>
    
      <li><span>Jan 28, 2009</span> &raquo; <a href="/vba/error-in-excel-2007-workbooks-open-method.html">Error in Excel 2007 workbooks open method</a></li>
    
      <li><span>Jun 24, 2008</span> &raquo; <a href="/vba/password-generator.html">Simple password generator</a></li>
    
  </ul>
</div>



  

  <!-- Add Disqus comments. -->
  <div id="disqus_thread"></div>
  <script type="text/javascript">
var disqus_config = function () {
  this.page.url = 'http://wazza-is-awesome.com/devops/taking-control-of-your-ssh-config.html';
  this.page.identifier = '/devops/taking-control-of-your-ssh-config';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = '//wazza-is-awesome.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <!-- End Disqus comments. -->





      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">wazza is awesome</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>wazza is awesome</li>
          <li><a href="mailto:warren /at/ bainsworld.com">warren /at/ bainsworld.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/thoughtcroft"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">thoughtcroft</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/thoughtcroft"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">thoughtcroft</span></a>

          </li>
          

          
          <li>
            <a href="https://au.linkedin.com/in/warrenbain"><span class="icon icon--linkedin"><svg viewBox="0 0 16 16"><path fill="#6F80BC" d="M4.724,14H2.152V6.26h2.572V14z M3.438,5.204H3.422C2.559,5.204,2,4.609,2,3.867 c0-0.759,0.575-1.337,1.456-1.337c0.879,0,1.421,0.579,1.438,1.337C4.894,4.609,4.335,5.204,3.438,5.204z M14,14h-2.572V9.859 c0-1.04-0.37-1.75-1.302-1.75c-0.712,0-1.135,0.478-1.321,0.94C8.738,9.215,8.721,9.447,8.721,9.678V14H6.148 c0,0,0.034-7.014,0-7.74h2.573v1.097c0.342-0.527,0.953-1.278,2.316-1.278C12.73,6.079,14,7.185,14,9.562V14z"/></svg>
</span><span class="username">warrenbain</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>A vainglorious attempt to prove Wazza's general awesomeness. Then again, people have actually rated him for that on LinkedIn.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
